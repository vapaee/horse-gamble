<div class="transfer-form">

    <!-- Form View -->
    <div *ngIf="transferStatus.state === 'none'">
        <div class="container-available">
            <p class="small">Available:</p>
            <strong *ngIf="balance; else loadingText">
                {{ balance.amount.formatted }} {{ balance.token.symbol }}
            </strong>
            <ng-template #loadingText>
                <span>Loading balance...</span>
            </ng-template>
        </div>
        <br>

        <form [formGroup]="form" (ngSubmit)="transfer()">
            <!-- Recipient Input -->
            <div class="container-input">
                <label class="small" for="recipient">Transfer to:</label>
                <input id="recipient" type="text" formControlName="recipient" placeholder="Enter EOSIO username" />

                <p *ngIf="form.get('recipient')?.value" class="small">
                    <span *ngIf="form.get('recipient')?.pending" class="checking">⏳ Checking account...</span>
                    <span *ngIf="form.get('recipient')?.errors?.['pattern']" class="invalid">❌ Wrong EOSIO pattern, 1-12 characters (a-z, 1-5)</span>
                    <span *ngIf="form.get('recipient')?.errors?.['selfTransfer']" class="invalid">❌ Cannot send tokens to yourself</span>
                    <span *ngIf="form.get('recipient')?.errors?.['accountNotFound']" class="invalid">❌ Account does not exist</span>
                    <span *ngIf="form.get('recipient')?.valid && !form.get('recipient')?.pending" class="valid">✅ Verified Account</span>
                </p>
            </div>

            <!-- Amount Input -->
            <div class="container-input">
                <div class="bar">
                    <label class="small" for="amount">Amount:</label>
                    <a *ngIf="!isMaxAmount()" class="small max" (click)="useMax()">Use Max</a>
                </div>
                <input id="amount" type="text" formControlName="amount" placeholder="Enter whole number" autocomplete="off" />

                <p *ngIf="form.get('amount')?.value !== null" class="small">
                    <span *ngIf="form.get('amount')?.errors?.['invalidAmount']" class="invalid">❌ Invalid amount</span>
                    <span *ngIf="form.get('amount')?.errors?.['outOfBalance']" class="invalid">❌ Amount exceeds balance</span>
                    <span *ngIf="form.get('amount')?.valid" class="valid">✅ Amount is within balance</span>
                </p>
            </div>

            <!-- Transfer Button -->
            <div class="container-transfer">
                <br>
                <button [class]="form.valid ? 'btn2' : 'unable'" type="submit" [disabled]="form.invalid || isLoading">
                    {{ isLoading ? 'Processing...' : 'Transfer' }}
                </button>
            </div>
        </form>
    </div>

    <!-- Success View -->
    <div *ngIf="transferStatus.state === 'success'" class="result-view success">
        <p class="message">
            <strong class="success-transfer">
                ✅ Successful Transfer
            </strong>
        </p>
        <p class="summary">{{ transferStatus.message }}</p>

        <button class="btn2" (click)="close()">Close</button>
    </div>

    <!-- Failure View -->
    <div *ngIf="transferStatus.state === 'failure'" class="result-view failure">
        <p class="message">
            <strong class="fail-transfer">
                ❌ Transfer Failed
            </strong>
        </p>
        <p class="error-message">{{ transferStatus.message }}</p>

        <div class="button-group">
            <button class="btn2" (click)="retry()">Retry</button>
            <button class="btn2" (click)="close()">Close</button>
        </div>
    </div>

</div>
